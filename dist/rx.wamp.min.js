(function(a){var b={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},c=b[typeof window]&&window||this,d=b[typeof exports]&&exports&&!exports.nodeType&&exports,e=b[typeof module]&&module&&!module.nodeType&&module,f=(e&&e.exports===d&&d,b[typeof global]&&global);!f||f.global!==f&&f.window!==f||(c=f),"function"==typeof define&&define.amd?define(["rx","autobahn","exports"],function(b,autobahn,d){return c.Rx=a(c,d,b,autobahn),c.Rx}):"object"==typeof module&&module&&module.exports===d?module.exports=function(b){return b||(b=require("autobahn")),a(c,module.exports,require("rx"),b)}:c.Rx=a(c,{},c.Rx,c.autobahn)}).call(this,function(a,b,c,autobahn){function d(a){return new autobahn._connection_cls(a)}var e=c.Observable,f=c.WAMP={},g=e.empty,h=e.create,i=e.fromPromise,j=c.Observer,k=j.create,l=(c.Subject,c.Disposable),m=c.CompositeDisposable,n=c.SerialDisposable,autobahn=autobahn||ab,o=(autobahn.Session.prototype,c.helpers.isPromise),p=c.helpers.noop,q=function(){return"function"!=typeof autobahn.version||"?.?.?"!==autobahn.version()&&autobahn.Connection?2:1},r=q(),s=autobahn.CONNECTION_CLOSED||"closed",t=autobahn.CONNECTION_UNREACHABLE||"unreachable",u=autobahn.CONNECTION_LOST||"lost";autobahn._connection_cls=autobahn.Connection||function(a){var b;if("string"==typeof a)b=a,a={};else{if("object"!=typeof a)throw new Error("Wamp options must not be undefined or null!");b=a.uri||a.url}var c=new n;this._onopen=function(a){c.setDisposable(l.create(function(){a.close()})),!c.isDisposed&&this.onopen&&this.onopen(a)},this.open=function(){autobahn.connect(b,this._onopen.bind(this),this.onclose,a)},this.close=function(){c.dispose()},this.onopen=null,this.onclose=null},f.fromConnection=e.fromConnection=function(a,b,c){var f=q(),g=(c||d)(a);return e.create(function(a){return g.onopen=function(b){a.onNext(b)},g.onclose=function(c,d,e){var g=c,h=f?g:d,e=f?d:e;switch(c){case t:a.onError({reason:h,details:e,code:g});break;case u:if(!b.isDisposed)return!0;case s:default:a.onCompleted()}return!1},g.open(),function(){g&&g.close()}})},f.fromSession=e.fromSession=function(a,b){return h(function(c){function d(){c.onNext(f)}function e(a,b){a===s?c.onCompleted():c.onError(a,b)}var f=new autobahn.Session(a,d,e,b);return l.create(function(){f.close()})})},f.authreqAsObservable=e.authreqAsObservable=function(a,b,c,d){return i(a.authreq(c,d)).flatMap(function(c){return b.call(a,c)})},f.fromPubSubPattern=e.fromPubSubPattern=function(a,b,c,d){return new y(a,b,c,d)};var v=function(){function a(a,b,c){this.session=a,this.disposer=c,this.subscription=null;var d=this;this.subscriptionSubscription=b(k(function(a){d.subscription=a},function(){d.dispose()}))}return c.internals.addProperties(a.prototype,{dispose:function(){this.subscriptionSubscription&&this.subscriptionSubscription.dispose(),this.subscription&&this.disposer.call(this,this.session,this.subscription)}}),a}(),w=function(a){function b(b,c){a.call(this,b,function(a){return c.subscribe(a)},d)}var d=2==r?function(a,b){a.unsubscribe(b)}:function(a,b){a.unsubscribe(b.topic,b.handler)};return c.internals.inherits(b,v),b}(v),x=function(a){function b(b,c){a.call(this,b,function(a){return c.subscribe(a)},function(a,b){a.unregister(b)})}return c.internals.inherits(b,a),b}(v);f.subscribeAsObservable=e.subscribeAsObservable=function(a,b,c,d){var f=2==r;return h(function(g){var j=f?function(a,b,c){var d={};a&&(d.args=a),b&&(d.kwargs=b),c&&(d.details=c),g.onNext(d)}:function(a,b){g.onNext({topic:a,event:b})};a.subscribe&&a.unsubscribe&&(a=e.just(a));var k,l=a.flatMapLatest(function(a){var d=a.subscribe(b,j,c)||{topic:b,handler:j},f=o(d)?i(d):e.just(d);return h(function(b){return new m(new w(a,f),f.subscribe(b.onNext.bind(b),b.onError.bind(b)))})});return d&&("function"==typeof d&&(k=d),"object"==typeof d&&(k=d.onNext.bind(d))),!k&&(k=p),l.subscribe(k,g.onError.bind(g))}).publish().refCount()},f.publishAsObservable=e.publishAsObservable=function(a){for(var b=[],c=arguments.length,d=1;c>d;++d)b.push(arguments[d]);var e=a.publish.apply(a,b);return e?i(e):g()},f.registerAsObservable=e.registerAsObservable=function(a,b,c,d){return h(function(f){a.unregister&&a.register&&(a=e.just(a));var g=a.flatMapLatest(function(a){var e=a.register(b,c,d),f=i(e);return h(function(b){return new m(new x(a,f),f.subscribe(b.onNext.bind(b),b.onError.bind(b)))})});return g.subscribe(f)}).publish().refCount()},f.callAsObservable=e.callAsObservable=function(a,b,c){return function(){for(var d=[b],e=arguments.length,f=0;e>f;++f)d.push(arguments[f]);return c&&d.push(c),i(a.call.apply(a,d))}};var y=c.PubSubSubject=function(a){function b(b,d,f,g){var h=this;this._errorObservable=new c.Subject,this._openObserver=new c.Subject,this.observable=e.subscribeAsObservable(b,d,f,this._openObserver),this.observer=c.Observer.create(function(a){e.publishAsObservable(b,d,a.args||a.event,a.kwargs,a.options).subscribeOnError(h._errorObservable.onNext.bind(h._errorObservable))}),Object.defineProperty(h,"errors",{get:function(){return h._errorObservable.asObservable()}}),Object.defineProperty(h,"opened",{get:function(){return h._openObserver.asObservable()}}),!g||"function"!=typeof g&&"object"!=typeof g||this.opened.subscribe(g),a.call(this,this.observable.subscribe.bind(this.observable))}return c.internals.inherits(b,a),c.internals.addProperties(b.prototype,c.Observer,{onCompleted:function(){this.observer.onCompleted()},onError:function(a){this.observer.onError(a)},onNext:function(a){this.observer.onNext(a)}}),b}(c.Observable);return c});
//# sourceMappingURL=rx.wamp.map